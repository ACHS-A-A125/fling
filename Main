local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer
local velocityMultiplier = 50000 -- strong fling power
local orbitRadius = 4 -- how far you orbit around target
local orbitSpeed = 20 -- how fast you orbit around them
local verticalOffset = 2 -- height offset
local forceCFrameEachStep = true

local hrp, char
local conn
local flingActive = true

-- Get local HRP safely
local function getLocalHRP()
	local chr = localPlayer.Character or localPlayer.CharacterAdded:Wait()
	local root = chr:WaitForChild("HumanoidRootPart", 5) or chr:FindFirstChild("Torso")
	return root, chr
end

-- Start orbit-fling loop
local function startFling()
	if conn then conn:Disconnect() end
	if not hrp or not hrp.Parent then return end

	local t = 0
	conn = RunService.Heartbeat:Connect(function(dt)
		if not flingActive then
			conn:Disconnect()
			conn = nil
			return
		end

		local targetPlayer = Players:FindFirstChild(_G.targetPlayerName)
		if not targetPlayer or not targetPlayer.Character then return end

		local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
			or targetPlayer.Character:FindFirstChild("Torso")
		if not targetHRP then return end

		t += dt * orbitSpeed

		local orbitX = math.cos(t) * orbitRadius
		local orbitZ = math.sin(t) * orbitRadius
		local orbitPos = targetHRP.Position + Vector3.new(orbitX, verticalOffset, orbitZ)

		local toTarget = targetHRP.Position - hrp.Position
		local direction = toTarget.Unit

		-- push toward target to ensure constant collisions
		local flingVector = direction * velocityMultiplier

		pcall(function()
			if hrp:IsA("BasePart") then
				hrp.AssemblyLinearVelocity = flingVector + Vector3.new(0, 0, 0)
			else
				hrp.Velocity = flingVector
			end
		end)

		if forceCFrameEachStep then
			-- face the target while orbiting
			hrp.CFrame = CFrame.lookAt(orbitPos, targetHRP.Position)
		else
			hrp.CFrame = CFrame.new(orbitPos)
		end
	end)
end

-- Stop fling safely
local function stopFling()
	flingActive = false
	if conn then
		conn:Disconnect()
		conn = nil
	end
end

-- Initialize and start fling
local function setupCharacter(character)
	hrp, char = getLocalHRP()
	if not hrp then return end

	local humanoid = char:FindFirstChildWhichIsA("Humanoid")
	if humanoid then
		pcall(function()
			humanoid.PlatformStand = false
			humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
		end)

		humanoid.Died:Connect(stopFling)
	end

	startFling()
end

if localPlayer.Character then
	setupCharacter(localPlayer.Character)
end

print("[orbit-fling] active. Targeting:", _G.targetPlayerName)
