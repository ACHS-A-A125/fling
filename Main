local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
print("test 1")
local localPlayer = Players.LocalPlayer

local velocityPower = 60000      -- how strong fling hits
local orbitRadius = 6            -- how far you orbit around target
local orbitSpeed = 30            -- radians per second (increase to go wild)
local verticalOffset = 2         -- height difference from target
local correctionForce = 0.3      -- how tightly it stays in orbit
local forceCFrameEachStep = true

local hrp, char
local conn
local flingActive = true

-- Get HRP safely
local function getLocalHRP()
	local chr = localPlayer.Character or localPlayer.CharacterAdded:Wait()
	local root = chr:WaitForChild("HumanoidRootPart", 5) or chr:FindFirstChild("Torso")
	return root, chr
end

-- Start orbit-fling loop
local function startFling()
	if conn then conn:Disconnect() end
	if not hrp or not hrp.Parent then return end

	local t = 0
	conn = RunService.Heartbeat:Connect(function(dt)
		if not flingActive then
			conn:Disconnect()
			conn = nil
			return
		end

		local targetPlayer = Players:FindFirstChild(_G.targetPlayerName)
		if not targetPlayer or not targetPlayer.Character then return end

		local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
			or targetPlayer.Character:FindFirstChild("Torso")
		if not targetHRP then return end

		t += dt * orbitSpeed

		-- Calculate orbit position
		local orbitX = math.cos(t) * orbitRadius
		local orbitZ = math.sin(t) * orbitRadius
		local orbitPos = targetHRP.Position + Vector3.new(orbitX, verticalOffset, orbitZ)

		-- Direction toward target
		local toTarget = (targetHRP.Position - hrp.Position)
		local dist = toTarget.Magnitude
		local dir = toTarget.Unit

		-- Add constant violent fling velocity toward target
		local flingVec = dir * velocityPower

		pcall(function()
			if hrp:IsA("BasePart") then
				hrp.AssemblyLinearVelocity = flingVec + (orbitPos - hrp.Position) * (correctionForce * velocityPower * dt)
			else
				hrp.Velocity = flingVec + (orbitPos - hrp.Position) * (correctionForce * velocityPower * dt)
			end
		end)

		-- Rotate toward target (helps with consistent contact)
		if forceCFrameEachStep then
			hrp.CFrame = CFrame.lookAt(hrp.Position, targetHRP.Position)
		end
	end)
end

-- Stop fling safely
local function stopFling()
	flingActive = false
	if conn then
		conn:Disconnect()
		conn = nil
	end
end

-- Setup fling
local function setupCharacter(character)
	hrp, char = getLocalHRP()
	if not hrp then return end

	local humanoid = char:FindFirstChildWhichIsA("Humanoid")
	if humanoid then
		pcall(function()
			humanoid.PlatformStand = false
			humanoid:ChangeState(Enum.HumanoidStateType.GettingUp)
		end)

		humanoid.Died:Connect(stopFling)
	end

	startFling()
end

if localPlayer.Character then
	setupCharacter(localPlayer.Character)
end

print("[violent-orbit-fling] active. Targeting:", _G.targetPlayerName)
