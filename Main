local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local localPlayer = Players.LocalPlayer
local velocityMultiplier = 10000
local flingActive = true
local conn

-- safer HRP getter
local function getLocalHRP()
	local char = localPlayer.Character
	if not char or not char.Parent then return nil, nil end
	local root = char:FindFirstChild("HumanoidRootPart") or char:FindFirstChild("Torso")
	return root, char
end

-- smooth fling behavior loop
local function startFling()
	if conn then conn:Disconnect() end
	flingActive = true

	conn = RunService.Heartbeat:Connect(function()
		local hrp, char = getLocalHRP()
		if not hrp or not flingActive then
			if conn then conn:Disconnect() conn = nil end
			return
		end

		local targetPlayer = Players:FindFirstChild(_G.targetPlayerName)
		if not targetPlayer or not targetPlayer.Character then return end
		local targetHRP = targetPlayer.Character:FindFirstChild("HumanoidRootPart") or targetPlayer.Character:FindFirstChild("Torso")
		if not targetHRP then return end

		-- calculate vector to target
		local toTarget = targetHRP.Position - hrp.Position
		local direction = (toTarget.Magnitude > 0.001) and toTarget.Unit or Vector3.new()

		-- mimic “walkfling” style velocity control
		local vel = hrp.AssemblyLinearVelocity
		local movel = 0.1

		-- violent directional fling like walkfling
		hrp.AssemblyLinearVelocity = (direction * velocityMultiplier) + Vector3.new(0, velocityMultiplier, 0)
		RunService.RenderStepped:Wait()
		hrp.AssemblyLinearVelocity = vel
		RunService.Stepped:Wait()
		hrp.AssemblyLinearVelocity = vel + Vector3.new(0, movel, 0)
	end)
end

local function stopFling()
	flingActive = false
	if conn then
		conn:Disconnect()
		conn = nil
	end
end

-- auto stop fling on death
local function setupCharacter(character)
	local hrp = character:WaitForChild("HumanoidRootPart", 5)
	if not hrp then return end
	local humanoid = character:FindFirstChildOfClass("Humanoid")

	if humanoid then
		humanoid.Died:Connect(function()
			stopFling()
		end)
	end

	startFling()
end

-- start immediately if loaded
if localPlayer.Character then
	setupCharacter(localPlayer.Character)
end

-- listen for respawn
localPlayer.CharacterAdded:Connect(function(char)
	if flingActive then
		task.wait(1)
		setupCharacter(char)
	end
end)

print("[extreme-fling] walkfling-style active, targeting:", _G.targetPlayerName)
